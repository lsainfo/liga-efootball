<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liga eFootball - Tabela de Classificação</title>
    <meta name="description" content="Acompanhe a classificação e resultados da Liga eFootball">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .efootball-gradient { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #06b6d4 100%); }
        .team-row:hover { transform: translateY(-1px); transition: all 0.2s ease; }
        .match-input { transition: all 0.2s ease; }
        .match-input:focus { transform: scale(1.05); }
        .loading { opacity: 0.6; pointer-events: none; }
        .saved { border-color: #10b981 !important; background-color: #ecfdf5; }

        @media (max-width: 768px) {
            .mobile-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .mobile-table { min-width: 600px; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="efootball-gradient text-white py-8 mb-8">
        <div class="container mx-auto px-4 relative">
            <div class="flex items-center justify-center space-x-4">
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
                    <svg class="w-10 h-10 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                </div>
                <div class="text-center">
                    <h1 class="text-4xl font-bold">eFootball Liga</h1>
                    <p class="text-blue-100 text-lg">Temporada 2025</p>
                </div>
                <button onclick="shareLeague()" class="share-button absolute top-4 right-4 px-4 py-2 text-white font-semibold rounded-lg transition-all duration-300 flex items-center space-x-2 bg-green-500 hover:bg-green-600 shadow-lg">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.700"/>
                    </svg>
                    <span class="hidden sm:inline">Compartilhar</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 max-w-7xl">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-blue-600 to-cyan-500 text-white p-6">
                <h2 class="text-2xl font-bold flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    Tabela de Classificação
                </h2>
            </div>
            <div class="mobile-scroll">
                <table class="w-full mobile-table">
                    <thead class="bg-gray-100">
                        <tr class="text-sm font-semibold text-gray-700">
                            <th class="px-4 py-3 text-left">Pos</th>
                            <th class="px-4 py-3 text-left">Jogador</th>
                            <th class="px-4 py-3 text-center font-bold">PTS</th>
                            <th class="px-4 py-3 text-center">J</th>
                            <th class="px-4 py-3 text-center">V</th>
                            <th class="px-4 py-3 text-center">E</th>
                            <th class="px-4 py-3 text-center">D</th>
                            <th class="px-4 py-3 text-center">GP</th>
                            <th class="px-4 py-3 text-center">GC</th>
                            <th class="px-4 py-3 text-center">SG</th>
                        </tr>
                    </thead>
                    <tbody id="leagueTable">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="roundsSection" class="bg-white rounded-xl shadow-lg overflow-hidden">
            <div class="bg-gradient-to-r from-green-600 to-emerald-500 text-white p-6">
                <h2 class="text-2xl font-bold flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                    </svg>
                    Resultados das Rodadas
                </h2>
            </div>
            <div class="p-6">
                <div id="roundsContainer" class="space-y-6">
                    </div>
            </div>
        </div>

        <div id="playoffsSection" class="hidden container mx-auto px-4 max-w-7xl mt-8">
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-purple-600 to-indigo-500 text-white p-6">
                    <h2 class="text-2xl font-bold flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2l-2.4 4.8 5.2 1.04-2.8 4.6 2.4-4.8-5.2-1.04 2.8-4.6zM12 10.15l-1.92-3.84L6.96 6.8l3.68 6.08L5.6 15.6l6.4-1.28L18.4 15.6l-5.04-2.6-3.68-6.08L12 10.15z"/>
                        </svg>
                        Fase Eliminatória
                    </h2>
                </div>
                <div class="p-6 space-y-8">
                    <div id="semifinalsContainer" class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Semifinais</h3>
                        </div>
                    <div id="finalContainer" class="space-y-4">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Final</h3>
                        </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Configuração do Supabase
        const SUPABASE_URL = 'https://dwtvzmzooldlhrbdbesk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3dHZ6bXpvb2xkbGhyYmRiZXNrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2OTg0MTUsImV4cCI6MjA3MDI3NDQxNX0.JPmuxbZIKdtG4A7lWrH2r-pD8SMIxaBF_xLB1m7w1lo';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Dados dos times
        const teams = [
            'CHEFÃO CL', 'FELIPINTO FC', 'JACERE__FC', 'L.S.A FC',
            'MIRASSOL', 'MODELO FC', 'REAL SERTÃO FC', 'REVOADA FC'
        ].sort();

        // Dados das rodadas
        const rounds = [
            [
                ['L.S.A FC', 'REVOADA FC'],
                ['JACERE__FC', 'REAL SERTÃO FC'],
                ['FELIPINTO FC', 'CHEFÃO CL'],
                ['MODELO FC', 'MIRASSOL']
            ],
            [
                ['L.S.A FC', 'REAL SERTÃO FC'],
                ['REVOADA FC', 'CHEFÃO CL'],
                ['JACERE__FC', 'MIRASSOL'],
                ['FELIPINTO FC', 'MODELO FC']
            ],
            [
                ['L.S.A FC', 'CHEFÃO CL'],
                ['REAL SERTÃO FC', 'MIRASSOL'],
                ['REVOADA FC', 'MODELO FC'],
                ['JACERE__FC', 'FELIPINTO FC']
            ],
            [
                ['L.S.A FC', 'MIRASSOL'],
                ['CHEFÃO CL', 'MODELO FC'],
                ['REAL SERTÃO FC', 'FELIPINTO FC'],
                ['REVOADA FC', 'JACERE__FC']
            ],
            [
                ['L.S.A FC', 'MODELO FC'],
                ['MIRASSOL', 'FELIPINTO FC'],
                ['CHEFÃO CL', 'JACERE__FC'],
                ['REAL SERTÃO FC', 'REVOADA FC']
            ],
            [
                ['L.S.A FC', 'FELIPINTO FC'],
                ['MODELO FC', 'JACERE__FC'],
                ['MIRASSOL', 'REAL SERTÃO FC'],
                ['CHEFÃO CL', 'REVOADA FC']
            ],
            [
                ['L.S.A FC', 'JACERE__FC'],
                ['FELIPINTO FC', 'REVOADA FC'],
                ['MODELO FC', 'CHEFÃO CL'],
                ['REAL SERTÃO FC', 'MIRASSOL']
            ]
        ];

        // Estatísticas dos times
        let teamStats = {};
        let matchesData = [];
        let playoffsMatches = [];

        // Inicializar estatísticas
        function initializeStats() {
            teams.forEach(team => {
                teamStats[team] = {
                    games: 0, wins: 0, draws: 0, losses: 0,
                    goalsFor: 0, goalsAgainst: 0, points: 0
                };
            });
        }

        // Função para calcular saldo de gols
        function calculateGoalDifference(goalsFor, goalsAgainst) {
            return goalsFor - goalsAgainst;
        }

        // Função para calcular estatísticas baseado nos dados do banco
        function calculateStats() {
            initializeStats();

            matchesData.forEach(match => {
                if (match.goals1 !== null && match.goals2 !== null) {
                    const team1 = match.team1;
                    const team2 = match.team2;
                    const goals1 = match.goals1;
                    const goals2 = match.goals2;

                    // Atualizar estatísticas
                    teamStats[team1].games++;
                    teamStats[team2].games++;
                    teamStats[team1].goalsFor += goals1;
                    teamStats[team1].goalsAgainst += goals2;
                    teamStats[team2].goalsFor += goals2;
                    teamStats[team2].goalsAgainst += goals1;

                    if (goals1 > goals2) {
                        teamStats[team1].wins++;
                        teamStats[team1].points += 3;
                        teamStats[team2].losses++;
                    } else if (goals1 < goals2) {
                        teamStats[team2].wins++;
                        teamStats[team2].points += 3;
                        teamStats[team1].losses++;
                    } else {
                        teamStats[team1].draws++;
                        teamStats[team2].draws++;
                        teamStats[team1].points++;
                        teamStats[team2].points++;
                    }
                }
            });
        }

        // Função para atualizar a tabela
        function updateTable() {
            calculateStats();
            const tableBody = document.getElementById('leagueTable');

            // Ordenar times por pontos, depois por saldo de gols
            const sortedTeams = teams.slice().sort((a, b) => {
                const statsA = teamStats[a];
                const statsB = teamStats[b];

                if (statsB.points !== statsA.points) {
                    return statsB.points - statsA.points;
                }

                const sgA = calculateGoalDifference(statsA.goalsFor, statsA.goalsAgainst);
                const sgB = calculateGoalDifference(statsB.goalsFor, statsB.goalsAgainst);

                if (sgB !== sgA) {
                    return sgB - sgA;
                }

                return statsB.goalsFor - statsA.goalsFor;
            });

            tableBody.innerHTML = '';
            sortedTeams.forEach((team, index) => {
                const stats = teamStats[team];
                const goalDiff = calculateGoalDifference(stats.goalsFor, stats.goalsAgainst);
                const position = index + 1;

                let positionClass = '';
                if (position <= 4) positionClass = 'bg-green-50 border-l-4 border-green-500';
                else if (position >= 7) positionClass = 'bg-red-50 border-l-4 border-red-500';

                const row = document.createElement('tr');
                row.className = `team-row ${positionClass} hover:bg-gray-50`;
                row.innerHTML = `
                    <td class="px-4 py-3 font-bold text-gray-800">${position}º</td>
                    <td class="px-4 py-3 font-semibold text-gray-900">${team}</td>
                    <td class="px-4 py-3 text-center font-bold text-lg text-blue-700">${stats.points}</td>
                    <td class="px-4 py-3 text-center text-gray-700">${stats.games}</td>
                    <td class="px-4 py-3 text-center text-green-600 font-semibold">${stats.wins}</td>
                    <td class="px-4 py-3 text-center text-yellow-600 font-semibold">${stats.draws}</td>
                    <td class="px-4 py-3 text-center text-red-600 font-semibold">${stats.losses}</td>
                    <td class="px-4 py-3 text-center text-blue-600 font-semibold">${stats.goalsFor}</td>
                    <td class="px-4 py-3 text-center text-red-500 font-semibold">${stats.goalsAgainst}</td>
                    <td class="px-4 py-3 text-center font-bold ${goalDiff >= 0 ? 'text-green-600' : 'text-red-600'}">${goalDiff >= 0 ? '+' : ''}${goalDiff}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Função para verificar se todos os jogos da fase de grupos foram jogados
        function isGroupStageComplete() {
            const totalMatches = rounds.flat().length;
            const playedMatches = matchesData.filter(m => m.goals1 !== null && m.goals2 !== null).length;
            return playedMatches === totalMatches;
        }

        // Função para buscar dados do Supabase
        async function loadMatches() {
            try {
                const { data: regularMatches, error: regularError } = await supabase
                    .from('matches')
                    .select('*')
                    .order('round', { ascending: true });

                if (regularError) throw regularError;

                const { data: playoffsMatchesData, error: playoffsError } = await supabase
                    .from('knockout_matches')
                    .select('*')
                    .order('round', { ascending: true });
                
                if (playoffsError) throw playoffsError;

                matchesData = regularMatches || [];
                playoffsMatches = playoffsMatchesData || [];

                updateTable();
                updateRoundsDisplay();
                
                // Lógica para mostrar/esconder a fase eliminatória
                const playoffsSection = document.getElementById('playoffsSection');
                if (isGroupStageComplete()) {
                    playoffsSection.classList.remove('hidden');
                    createPlayoffs();
                } else {
                    playoffsSection.classList.add('hidden');
                }

            } catch (error) {
                console.error('Erro ao carregar dados:', error.message);
            }
        }

        // Função para salvar/atualizar resultado no Supabase
        async function saveMatch(tableName, round, team1, team2, goals1, goals2) {
            try {
                const existingMatch = (tableName === 'matches' ? matchesData : playoffsMatches).find(m =>
                    m.round === round && m.team1 === team1 && m.team2 === team2
                );
                
                const goals1Int = goals1 === '' ? null : parseInt(goals1);
                const goals2Int = goals2 === '' ? null : parseInt(goals2);

                const dataToSave = {};
                if (tableName === 'matches') {
                    dataToSave.goals1 = goals1Int;
                    dataToSave.goals2 = goals2Int;
                } else if (tableName === 'knockout_matches') {
                    dataToSave.score1 = goals1Int;
                    dataToSave.score2 = goals2Int;
                }

                if (existingMatch) {
                    const { error } = await supabase
                        .from(tableName)
                        .update(dataToSave)
                        .eq('id', existingMatch.id);

                    if (error) throw error;
                } else {
                    const { error } = await supabase
                        .from(tableName)
                        .insert([{
                            round: round,
                            team1: team1,
                            team2: team2,
                            ...dataToSave
                        }]);
                    if (error) throw error;
                }

                await loadMatches();

            } catch (error) {
                console.error('Erro ao salvar:', error.message);
            }
        }

        // Função para atualizar display das rodadas
        function updateRoundsDisplay() {
            rounds.forEach((round, roundIndex) => {
                round.forEach((match, matchIndex) => {
                    const team1 = match[0];
                    const team2 = match[1];

                    // Buscar dados salvos para este jogo
                    const savedMatch = matchesData.find(m => 
                        m.round === roundIndex + 1 && m.team1 === team1 && m.team2 === team2
                    );

                    const goals1Input = document.getElementById(`goals_${roundIndex}_${matchIndex}_0`);
                    const goals2Input = document.getElementById(`goals_${roundIndex}_${matchIndex}_1`);

                    if (goals1Input && goals2Input && savedMatch) {
                        goals1Input.value = savedMatch.goals1 !== null ? savedMatch.goals1 : '';
                        goals2Input.value = savedMatch.goals2 !== null ? savedMatch.goals2 : '';

                        // Adicionar classe visual se o jogo foi salvo
                        if (savedMatch.goals1 !== null && savedMatch.goals2 !== null) {
                            goals1Input.classList.add('saved');
                            goals2Input.classList.add('saved');
                        } else {
                            goals1Input.classList.remove('saved');
                            goals2Input.classList.remove('saved');
                        }
                    }
                });
            });
        }

        // Criar interface das rodadas
        function createRounds() {
            const container = document.getElementById('roundsContainer');
            container.innerHTML = '';

            rounds.forEach((round, roundIndex) => {
                const roundDiv = document.createElement('div');
                roundDiv.className = 'bg-gray-50 rounded-lg p-4';
                roundDiv.innerHTML = `
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center justify-between">
                        <span class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm mr-3">Rodada ${roundIndex + 1}</span>
                        <button onclick="shareRoundResults(${roundIndex + 1})" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-sm font-medium transition
